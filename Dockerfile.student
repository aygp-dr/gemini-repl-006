FROM ubuntu:22.04

# Install basic tools
RUN apt-get update && apt-get install -y \
    curl \
    git \
    emacs \
    openjdk-17-jre-headless \
    && rm -rf /var/lib/apt/lists/*

# Install Babashka
RUN curl -sLO https://github.com/babashka/babashka/releases/download/v1.12.206/babashka-1.12.206-linux-amd64-static.tar.gz \
    && tar -xzf babashka-1.12.206-linux-amd64-static.tar.gz \
    && mv bb /usr/local/bin/ \
    && rm babashka-1.12.206-linux-amd64-static.tar.gz

# Install Clojure
RUN curl -L -O https://github.com/clojure/brew-install/releases/latest/download/linux-install.sh \
    && chmod +x linux-install.sh \
    && ./linux-install.sh \
    && rm linux-install.sh

# Create student user
RUN useradd -m -s /bin/bash student

# Set up workspace
USER student
WORKDIR /home/student

# Clone the exercise repo
RUN git clone https://github.com/aygp-dr/gemini-repl-006.git

WORKDIR /home/student/gemini-repl-006

# Set up git config (students will override)
RUN git config --global user.name "Student" \
    && git config --global user.email "student@example.com"

CMD ["/bin/bash"]